# 接口自动化测试
## 涵盖内容
1. 接口基础知识
2. 接口自动化框架
3. 接口测试工具使用
### 接口基础知识
1. 接口的分类
- 程序接口：提供了输入输出的的类、方法或函数
- 协议接口：系统通过不同的协议提供的接口（http/soap协议）
- 按照系统的调用方式：
  + 系统与系统之间的接口
  + 上层服务与下层服务的接口
  + 系统内部，服务与服务之间的接口
2. 接口的意义：
- 实现前后端分离，后端为前端提供接口，前端只需专注于数据的展示和页面的交互的设计
- 提供与数据库交互的功能，如增删改查，前端只需调用这些接口就可以完成数据的处理
3. web接口的构成
- 协议(http)
- 数据格式（json）
4. 接口的常用测试工具
- httprequester、postman
- 自动化测试工具：jmeter、robotframework、 soapUI
- 性能测试工具：jmeter、loadrunner、soapUI
### 接口自动化测试框架
1. 普通接口测试工具缺点
- 测试数据不可控（初始化）
- 加密接口无法测
- 扩展能力不足（持续集成）
2. 框架搭建
- unittest库+request库
- HTMLTestRunner生成测试报告（git下载，将.py文件复制到项目目录下，可自己进行定制）
- 集成初始化测试数据的功能（测试时不用正式的数据库，因此需要配置测试数据库，并自动生成测试数据，专门用来测试）
  + 修改数据库配置（settings）
  + 编写db_config.ini文件配置数据库信息
  + 编写mysql_db.py文件，创建DB类，定义init（连接数据库）/clear（清除表数据）/insert（插入表数据）/close（关闭数据库连接）方法处理测试数据库中的数据
  + test_data.py文件，创建测试数据，调用clear等方法，初始化测试数据库
  + 在测试用例main中调用test_data方法先初始化数据，再进行测试
### Jmeter使用
#### 简介
1. 功能：
接口测试，性能，压力，数据库，Java程序，web自动化测试
- 优点：
开源免费，支持多协议（http,https,ftp），小巧(40M),功能强大
- 缺点：
不支持IP欺骗（）
不支持前端测试
2. 环境搭建：
下载jdk,jmeter,解压缩，运行.jar .bat
3. 线程组：
关系：进程有多个线程组，线程组有多个线程
进程---测试计划
线程组---线程组
线程---线程组属性的线程数
4. 特殊线程组：
set up-----最先执行的线程组
tear down------最后执行的线程组
#### 使用
1. 参数化-csv（逗号分隔值文件格式） data setconfig的使用：
- 编写添加框架，设置循环次数，json数据格式固定，不加值
- 编写外部文档存储要添加的数据
- 添加组件，将文本中的数据读取出来添加进固定格式中（一次一行），最后提交
2. cookie session token操作
- 简介：
  + session：保存在服务器中，客户端携带session ID
  + cookie：保存在客户端，携带客户的身份信息，用于下次请求供服务器辨识
  + token：携带信息（cookie或session）并将其加密供服务器验证（非对称加密）
- jmeter 操作（以登录充值为例）
  + 登录请求添加正则表达式获取cookie的值
  + 充值请求添加http cookie管理器，携带cookie进行请求
  + 或者：直接在线程组下添加http cookie管理器
3. 关联请求情况
- 对第一次请求使用正则表达式提取器提取所需数据，设为变量供其它请求使用
4. 响应数据有中文
使用beanshell 编写代码进行解析

#### jmeter使用问题:
1、响应乱码：jmeter\bin\jmeter.properties文件下把sampleresult.default.encoding的属性改成UTF-8并解开注释。